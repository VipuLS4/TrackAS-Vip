CREATE EXTENSION IF NOT EXISTS "pgcrypto";
CREATE TABLE IF NOT EXISTS users ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), email TEXT UNIQUE, password TEXT, role TEXT, created_at TIMESTAMPTZ DEFAULT now() );
CREATE TABLE IF NOT EXISTS companies ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID REFERENCES users(id), name TEXT, email TEXT, address TEXT, tin TEXT, status TEXT DEFAULT 'PENDING', bank_account_number TEXT, bank_ifsc TEXT, bank_name TEXT, account_holder TEXT );
CREATE TABLE IF NOT EXISTS operators ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID REFERENCES users(id), name TEXT, license_no TEXT, mobile TEXT, online BOOLEAN DEFAULT false, status TEXT DEFAULT 'PENDING', bank_account_number TEXT, bank_ifsc TEXT, bank_name TEXT, account_holder TEXT );
CREATE TABLE IF NOT EXISTS vehicles ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), company_id UUID REFERENCES companies(id), type TEXT, reg_no TEXT UNIQUE, capacity_weight NUMERIC, capacity_volume NUMERIC, status TEXT DEFAULT 'PENDING', vcode TEXT );
CREATE TABLE IF NOT EXISTS shipments ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), company_id UUID REFERENCES companies(id), operator_id UUID REFERENCES operators(id), pickup TEXT, destination TEXT, length NUMERIC, width NUMERIC, height NUMERIC, weight NUMERIC, instructions TEXT, customer_name TEXT, customer_phone TEXT, customer_email TEXT, cost NUMERIC, commission_amount NUMERIC, commission_mode TEXT DEFAULT 'BEFORE', status TEXT DEFAULT 'CREATED', created_at TIMESTAMPTZ DEFAULT now() );
CREATE TABLE IF NOT EXISTS pings ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), shipment_id UUID REFERENCES shipments(id), lat NUMERIC, lng NUMERIC, ts TIMESTAMPTZ DEFAULT now() );
CREATE TABLE IF NOT EXISTS proof_of_delivery ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), shipment_id UUID REFERENCES shipments(id), path TEXT, uploaded_at TIMESTAMPTZ DEFAULT now() );
CREATE TABLE IF NOT EXISTS payments ( id TEXT PRIMARY KEY, shipment_id UUID REFERENCES shipments(id), amount NUMERIC, status TEXT, created_at TIMESTAMPTZ DEFAULT now() );
CREATE TABLE IF NOT EXISTS support_tickets ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_ref TEXT, role TEXT, message TEXT, contact TEXT, created_at TIMESTAMPTZ DEFAULT now(), status TEXT DEFAULT 'OPEN' );
CREATE TABLE IF NOT EXISTS ratings ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), shipment_id UUID REFERENCES shipments(id), rating INTEGER, comment TEXT, created_at TIMESTAMPTZ DEFAULT now() );
